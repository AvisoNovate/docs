<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>io.aviso.config documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Config</span> <span class="project-version">0.2.2</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1 current"><a href="io.aviso.config.html"><div class="inner"><span>io.aviso.config</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="io.aviso.config.html#var-assemble-configuration"><div class="inner"><span>assemble-configuration</span></div></a></li><li class="depth-1"><a href="io.aviso.config.html#var-Configurable"><div class="inner"><span>Configurable</span></div></a></li><li class="depth-2"><a href="io.aviso.config.html#var-configure"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>configure</span></div></a></li><li class="depth-1"><a href="io.aviso.config.html#var-configure-components"><div class="inner"><span>configure-components</span></div></a></li><li class="depth-1"><a href="io.aviso.config.html#var-default-resource-path"><div class="inner"><span>default-resource-path</span></div></a></li><li class="depth-1"><a href="io.aviso.config.html#var-default-variants"><div class="inner"><span>default-variants</span></div></a></li><li class="depth-1"><a href="io.aviso.config.html#var-with-config-spec"><div class="inner"><span>with-config-spec</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">io.aviso.config</h1><div class="doc"><div class="markdown"><p>A system for reading and coercing configuration data.</p>
<p>Configuration data is in the form of a <em>set</em> of files (mostly on the classpath) that follow a naming convention:</p>
<pre><code>conf/&lt;profile&gt;-&lt;variant&gt;.edn
</code></pre>
<p>The list of profiles and variants is provided by the application.</p>
<p>The configuration data is read from an appropriate set of such files, and merged together.</p>
<p>Each component’s individual configuration is validated and conformed against a spec that is specific to the component.</p></div></div><div class="public anchor" id="var-assemble-configuration"><h3>assemble-configuration</h3><div class="usage"><code>(assemble-configuration options)</code></div><div class="doc"><div class="markdown"><p>Reads the configuration, as specified by the options.</p>
<p>When the EDN files are read, a set of reader macros are enabled to allow for some dynamicism in the parsed content: this represents overrides from either shell environment variables, JVM system properties, or the :properties option.</p>
<dl>
  <dt>:additional-files
  </dt>
  <dd>A seq of absolute file paths that, if they exist, will be loaded last, after all  normal resources.  This is typically used to provide an editable (outside the classpath) file for final  production configuration overrides.</dd>
  <dt>:overrides
  </dt>
  <dd>A map of configuration data that is overlayed (using a deep merge)  on the configuration data read from the files, before validation and coercion.</dd>
  <dt>:profiles
  </dt>
  <dd>A seq of keywords that identify which profiles should be loaded and in what order.  The default is an empty list.</dd>
  <dt>:properties
  </dt>
  <dd>An optional map of additional properties that may be substituted (using  the <code>#config/prop</code> reader macro). Explicit properties have higher precendence than JVM  system properties, which have higher precendence than environment  variables; however the convention is that environment variable names  are all upper case, and properties are all lower case, so actual conflicts  should not occur.</dd>
  <dd>The keys of the properties map are converted to strings via <code>name</code>, so they  may be strings or symbols, or more frequently, keywords.</dd>
  <dd>Most often the properties map is used for specific overrides in testing, or  to expose some bit of configuration that cannot be directly extracted  from environment variables or JVM system properties.</dd>
  <dt>:variants
  </dt>
  <dd>The variants searched for, for each profile.</dd>
  <dd><a href="io.aviso.config.html#var-default-variants">default-variants</a> provides the default list of variants. A nil variant  is always prefixed on the provided list.</dd>
  <dt>:resource-path
  </dt>
  <dd>A function that builds resource paths from profile and variant.</dd>
  <dd>The default is <a href="io.aviso.config.html#var-default-resource-path">default-resource-path</a>, but this could be overridden  to (for example), use a directory structure to organize configuration files  rather than splitting up the different components of the name using dashes.</dd>
</dl>
<p>Any additional files are loaded after all profile and variant files.</p>
<p>The contents of each file are deep-merged together; later files override earlier files.</p>
<p>Overrides via the :overrides key are applied last; these are typically used only for testing purposes.</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/config/blob/master/src/io/aviso/config.clj#L149">view source</a></div></div><div class="public anchor" id="var-Configurable"><h3>Configurable</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Optional (but preferred) protocol for components.</p>
<p>When a component declares its configuration with <a href="io.aviso.config.html#var-with-config-spec">with-config-spec</a>, but does <em>not</em> implement this protocol, it will instead have a :configuration key associated with it.</p></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-configure"><h3>configure</h3><div class="usage"><code>(configure this configuration)</code></div><div class="doc"><div class="markdown"><p>Passes a component’s individual configuration to the component, as defined by <a href="io.aviso.config.html#var-with-config-spec">with-config-spec</a>.</p>
<p>The component’s configuration is extracted from the merged system configuration and conformed; the conformed configuration is passed to the component.</p>
<p>When this is invoked (see <a href="io.aviso.config.html#var-configure-components">configure-components</a>), a component’s dependencies <em>will</em> be available, but in an un-started state.</p></div></div></div></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/config/blob/master/src/io/aviso/config.clj#L236">view source</a></div></div><div class="public anchor" id="var-configure-components"><h3>configure-components</h3><h4 class="added">added in 0.1.9</h4><div class="usage"><code>(configure-components system-map configuration)</code></div><div class="doc"><div class="markdown"><p>Configures the components in the system map, returning an updated system map.</p>
<p>Typically, this should be invoked <em>before</em> the system is started, as most components are expected to need configuration in order to start.</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/config/blob/master/src/io/aviso/config.clj#L293">view source</a></div></div><div class="public anchor" id="var-default-resource-path"><h3>default-resource-path</h3><div class="usage"><code>(default-resource-path profile variant)</code></div><div class="doc"><div class="markdown"><p>Default mapping of a resource path from profile and variant.</p>
<dl>
  <dt>profile - keyword
  </dt>
  <dd>profile to add to path</dd>
  <dt>variant - keyword
  </dt>
  <dd>variant to add to the path, or nil</dd>
</dl>
<p>The result is typically “conf/profile-variant.edn”.</p>
<p>However, the “-variant” portion is omitted when variant is nil.</p>
<p>Returns a seq of files. Although this implementation only returns a single value, supporting a seq of values makes it easier to extend (rather than replace) the default behavior with an override.</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/config/blob/master/src/io/aviso/config.clj#L107">view source</a></div></div><div class="public anchor" id="var-default-variants"><h3>default-variants</h3><h4 class="added">added in 0.1.9</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>The default list of variants. The combination of profile and variant is the main way that resource file names are created (combined with a fixed prefix and a supported extension).</p>
<p>The order of the variants determine load order, which is relevant.</p>
<p>A nil variant is always prefixed to this list; this represents loading default configuration for the profile.</p>
<p>Typically, a library creates a component or other entity that is represented within config as a profile.</p>
<p>The local variant may be used for test-specific overrides, or overrides for a user’s development (say, to redirect a database connection to a local database), or even used in production.</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/config/blob/master/src/io/aviso/config.clj#L131">view source</a></div></div><div class="public anchor" id="var-with-config-spec"><h3>with-config-spec</h3><div class="usage"><code>(with-config-spec component config-key config-spec)</code></div><div class="doc"><div class="markdown"><p>Adds metadata to the component to define the configuration spec for the component.</p>
<p>This defines a top-level configuration key (e.g., :web-service) and a spec for just that key.</p>
<p>The component’s specific configuration is extracted from the merged configuration, and the component’s config spec is used to conform it. The conformed configuration is passed to the component.</p>
<p>The component will receive <em>just</em> it’s individual, conformed configuration in its :configuration key.</p>
<p>Alternately, the component may implement the <a href="io.aviso.config.html#var-Configurable">Configurable</a> protocol. It will be passed the conformed configuration.</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/config/blob/master/src/io/aviso/config.clj#L255">view source</a></div></div></div></body></html>