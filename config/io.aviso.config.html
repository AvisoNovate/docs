<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><link href="css/default.css" rel="stylesheet" type="text/css" /><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>io.aviso.config documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Config</span> <span class="project-version">0.1.11</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1 current"><a href="io.aviso.config.html"><div class="inner"><span>io.aviso.config</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="io.aviso.config.html#var-assemble-configuration"><div class="inner"><span>assemble-configuration</span></div></a></li><li class="depth-1"><a href="io.aviso.config.html#var-AssembleOptions"><div class="inner"><span>AssembleOptions</span></div></a></li><li class="depth-1"><a href="io.aviso.config.html#var-ConfigParser"><div class="inner"><span>ConfigParser</span></div></a></li><li class="depth-1"><a href="io.aviso.config.html#var-Configurable"><div class="inner"><span>Configurable</span></div></a></li><li class="depth-2"><a href="io.aviso.config.html#var-configure"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>configure</span></div></a></li><li class="depth-1"><a href="io.aviso.config.html#var-configure-components"><div class="inner"><span>configure-components</span></div></a></li><li class="depth-1"><a href="io.aviso.config.html#var-default-extensions"><div class="inner"><span>default-extensions</span></div></a></li><li class="depth-1"><a href="io.aviso.config.html#var-default-resource-path"><div class="inner"><span>default-resource-path</span></div></a></li><li class="depth-1"><a href="io.aviso.config.html#var-default-variants"><div class="inner"><span>default-variants</span></div></a></li><li class="depth-1"><a href="io.aviso.config.html#var-extend-system-map"><div class="inner"><span>extend-system-map</span></div></a></li><li class="depth-1"><a href="io.aviso.config.html#var-extract-schemas"><div class="inner"><span>extract-schemas</span></div></a></li><li class="depth-1"><a href="io.aviso.config.html#var-merge-value"><div class="inner"><span>merge-value</span></div></a></li><li class="depth-1"><a href="io.aviso.config.html#var-ResourcePathGenerator"><div class="inner"><span>ResourcePathGenerator</span></div></a></li><li class="depth-1"><a href="io.aviso.config.html#var-ResourcePathSelector"><div class="inner"><span>ResourcePathSelector</span></div></a></li><li class="depth-1"><a href="io.aviso.config.html#var-with-config-schema"><div class="inner"><span>with-config-schema</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">io.aviso.config</h1><div class="doc"><div class="markdown"><p>A system for reading and coercing configuration data.</p>
<p>Configuration data is in the form of a <em>set</em> of files (mostly on the classpath) that follow a naming convention:</p>
<pre><code>conf/&lt;profile&gt;-&lt;variant&gt;.&lt;extension&gt;
</code></pre>
<p>The list of profiles and variants is provided by the application.</p>
<p>Currently, the extensions “yaml” and “edn” are supported.</p>
<p>The configuration data is read from an appropriate set of such files, and merged together. The configuration is then passed through a Schema for validation and value coercion (for example, to convert strings into numeric types).</p>
<p>Validation helps ensure that simple typos are caught early. Coercion helps ensure that the data is both valid and in a format ready to be consumed.</p></div></div><div class="public anchor" id="var-assemble-configuration"><h3>assemble-configuration</h3><div class="usage"><code>(assemble-configuration options)</code></div><div class="doc"><div class="markdown"><p>Inputs: [options :- AssembleOptions]</p>
<p>Reads the configuration, as specified by the options.</p>
<p>Inside each configuration file, the content is scanned for property expansions.</p>
<p>Expansions allow environment variables, JVM system properties, or explicitly specific properties to be substituted into the content of a configuration file, <em>before</em> it is parsed.</p>
<p>Expansions take two forms:</p>
<ul>
  <li><code>${ENV_VAR}</code></li>
  <li><code>${ENV_VAR:default-value}</code></li>
</ul>
<p>In the former case, a non-nil value for the indicated property or environment variable must be available, or an exception is thrown.</p>
<p>In the later case, a nil value will be replaced with the indicated default value. e.g. <code>${HOST:localhost}</code>.</p>
<p>The :args option is passed command line arguments (as from a -main function). The arguments are used to add further additional files to load, and provide additional overrides.</p>
<p>Arguments are either “–load” followed by a path name, or “path=value”.</p>
<p>In the second case, the path and value are as defined by <a href="io.aviso.config.html#var-merge-value">merge-value</a>.</p>
<dl>
  <dt>:schemas
  </dt>
  <dd>A seq of schemas; these will be merged to form the full configuration schema.</dd>
  <dt>:additional-files
  </dt>
  <dd>A seq of absolute file paths that, if they exist, will be loaded last, after all  normal resources.  This is typically used to provide an editable (outside the classpath) file for final  production configuration overrides.</dd>
  <dt>:args
  </dt>
  <dd>Command line arguments to parse; these yield yet more additional files and  the last set of overrides.</dd>
  <dt>:overrides
  </dt>
  <dd>A map of configuration data that is overlayed (using a deep merge)  on the configuration data read from the files, before validation and coercion.</dd>
  <dt>:profiles
  </dt>
  <dd>A seq of keywords that identify which profiles should be loaded and in what order.  The default is an empty list.</dd>
  <dt>:properties
  </dt>
  <dd>An optional map of properties that may be substituted, just as environment  variable or System properties can be. Explicit properties have higher precendence than JVM  system properties, which have higher precendence than environment  variables; however the convention is that environment variable names  are all upper case, and properties are all lower case, so actual conflicts  should not occur.</dd>
  <dd>The keys of the properties map are converted to strings via <code>name</code>, so they  may be strings or symbols, or more frequently, keywords.</dd>
  <dd>Most often the properties map is used for specific overrides in testing, or  to expose some bit of configuration that cannot be directly extracted  from environment variables or JVM system properties.</dd>
  <dt>:variants
  </dt>
  <dd>The variants searched for, for each profile.</dd>
  <dd><a href="io.aviso.config.html#var-default-variants">default-variants</a> provides the default list of variants. A nil variant  is always prefixed on the provided list.</dd>
  <dt>:resource-path
  </dt>
  <dd>A function that builds resource paths from profile, variant, and extension.</dd>
  <dd>The default is <a href="io.aviso.config.html#var-default-resource-path">default-resource-path</a>, but this could be overridden  to (for example), use a directory structure to organize configuration files  rather than splitting up the different components of the name using dashes.</dd>
  <dt>:extensions
  </dt>
  <dd>Maps from extension (e.g., “yaml”) to an appropriate parsing function.</dd>
</dl>
<p>Any additional files are loaded after all profile and variant files.</p>
<p>Files specified via <code>--load</code> arguments are then loaded.</p>
<p>The contents of each file are deep-merged together; later files override earlier files.</p>
<p>Overrides via the :overrides key are applied, then overrides from command line arguments (provided in the :args option) are applied.</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/confiig/blob/master/src/io/aviso/config.clj#L230">view source</a></div></div><div class="public anchor" id="var-AssembleOptions"><h3>AssembleOptions</h3><h4 class="added">added in 0.1.10</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Defines the options passed to <a href="io.aviso.config.html#var-assemble-configuration">assemble-configuration</a>.</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/confiig/blob/master/src/io/aviso/config.clj#L218">view source</a></div></div><div class="public anchor" id="var-ConfigParser"><h3>ConfigParser</h3><h4 class="added">added in 0.1.10</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>A callback that is passed the content from a file and returns the parsed configuration.</p>
<p>Each extension is mapped to a corresponding ConfigParser.</p>
<p><a href="io.aviso.config.html#var-default-extensions">default-extensions</a> provides the default mappings.</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/confiig/blob/master/src/io/aviso/config.clj#L83">view source</a></div></div><div class="public anchor" id="var-Configurable"><h3>Configurable</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-configure"><h3>configure</h3><div class="usage"><code>(configure this configuration)</code></div><div class="doc"><div class="markdown"><p>Passes a component’s individual configuration to the component, as defined by the three-argument version of <a href="io.aviso.config.html#var-with-config-schema">with-config-schema</a>.</p>
<p>When this is invoked (see <a href="io.aviso.config.html#var-configure-components">configure-components</a>), a component’s dependencies <em>will</em> be available, but in an un-started state.</p></div></div></div></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/confiig/blob/master/src/io/aviso/config.clj#L352">view source</a></div></div><div class="public anchor" id="var-configure-components"><h3>configure-components</h3><h4 class="added">added in 0.1.9</h4><div class="usage"><code>(configure-components system-map)</code><code>(configure-components system-map configuration)</code></div><div class="doc"><div class="markdown"><p>Configures the compoments in the system map, returning an updated system map.</p>
<p>In the simple case, the configuration is expected to be in the :configuration key of the system map (the default when using <a href="io.aviso.config.html#var-extend-system-map">extend-system-map</a>.</p>
<p>In the two argument case, the component is supplied as the second parameter.</p>
<p>Typically, this should be invoked <em>before</em> the system is started, as most components are expected to need configuration in order to start.</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/confiig/blob/master/src/io/aviso/config.clj#L421">view source</a></div></div><div class="public anchor" id="var-default-extensions"><h3>default-extensions</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>The default mapping from file extension to a <a href="io.aviso.config.html#var-ConfigParser">ConfigParser</a> for content from such a file.</p>
<p>Provides parsers for the “yaml” and “edn” extensions.</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/confiig/blob/master/src/io/aviso/config.clj#L92">view source</a></div></div><div class="public anchor" id="var-default-resource-path"><h3>default-resource-path</h3><div class="usage"><code>(default-resource-path selector)</code></div><div class="doc"><div class="markdown"><p>Inputs: [selector :- ResourcePathSelector] Returns: [String]</p>
<p>Default mapping of a resource path from profile, variant, and extension. A single map is passed, with the following keys:</p>
<dl>
  <dt>:profile - keyword
  </dt>
  <dd>profile to add to path</dd>
  <dt>:variant - keyword
  </dt>
  <dd>variant to add to the path, or nil</dd>
  <dt>:extension - string
  </dt>
  <dd>extension (e.g., “yaml”)</dd>
</dl>
<p>The result is typically “conf/profile-variant.ext”.</p>
<p>However, “-variant” is omitted when variant is nil.</p>
<p>Since 0.1.10, returns a seq of files. Although this implementation only returns a single value, supporting a seq of values makes it easier to extend (rather than replace) the default behavior with an override.</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/confiig/blob/master/src/io/aviso/config.clj#L112">view source</a></div></div><div class="public anchor" id="var-default-variants"><h3>default-variants</h3><h4 class="added">added in 0.1.9</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>The default list of variants. The combination of profile and variant is the main way that resource file names are created (combined with a fixed prefix and a supported extension).</p>
<p>The order of the variants determine load order, which is relevant.</p>
<p>A nil variant is always prefixed to this list; this represents loading default configuration for the profile.</p>
<p>Typically, a library creates a component or other entity that is represented within config as a profile.</p>
<p>The local variant may be used for test-specific overrides, or overrides for a user’s development (say, to redirect a database connection to a local database), or even used in production.</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/confiig/blob/master/src/io/aviso/config.clj#L142">view source</a></div></div><div class="public anchor" id="var-extend-system-map"><h3>extend-system-map</h3><h4 class="added">added in 0.1.9</h4><div class="usage"><code>(extend-system-map system-map options)</code><code>(extend-system-map system-map configuration-key options)</code></div><div class="doc"><div class="markdown"><p>Uses the system map and options to read the configuration, using <a href="io.aviso.config.html#var-assemble-configuration">assemble-configuration</a>. Returns the system map with one extra component, the configuration itself (ready to be injected into the other components).</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/confiig/blob/master/src/io/aviso/config.clj#L392">view source</a></div></div><div class="public anchor" id="var-extract-schemas"><h3>extract-schemas</h3><div class="usage"><code>(extract-schemas components)</code></div><div class="doc"><div class="markdown"><p>For a seq of components (the values of a system map), extracts the schemas associated via <a href="io.aviso.config.html#var-with-config-schema">with-config-schema</a>, returning a seq of schemas.</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/confiig/blob/master/src/io/aviso/config.clj#L386">view source</a></div></div><div class="public anchor" id="var-merge-value"><h3>merge-value</h3><div class="usage"><code>(merge-value m arg)</code></div><div class="doc"><div class="markdown"><p>Merges a command-line argument into a map. The command line argument is of the form:</p>
<pre><code>path=value
</code></pre>
<p>where path is the path to value; it is split at slashes and the individual strings converted to keywords.</p>
<p>e.g.</p>
<pre><code>web-server/port=8080
</code></pre>
<p>is equivalent to</p>
<pre><code>(assoc-in m [:web-server :port] "8080")
</code></pre></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/confiig/blob/master/src/io/aviso/config.clj#L168">view source</a></div></div><div class="public anchor" id="var-ResourcePathGenerator"><h3>ResourcePathGenerator</h3><h4 class="added">added in 0.1.10</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>A callback that converts a configuration file <a href="io.aviso.config.html#var-ResourcePathSelector">ResourcePathSelector</a> into some number of resource path strings.</p>
<p>The standard implementation is <a href="io.aviso.config.html#var-default-resource-path">default-resource-path</a>.</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/confiig/blob/master/src/io/aviso/config.clj#L105">view source</a></div></div><div class="public anchor" id="var-ResourcePathSelector"><h3>ResourcePathSelector</h3><h4 class="added">added in 0.1.10</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Map of values passed to a <a href="io.aviso.config.html#var-ResourcePathGenerator">ResourcePathGenerator</a>.</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/confiig/blob/master/src/io/aviso/config.clj#L99">view source</a></div></div><div class="public anchor" id="var-with-config-schema"><h3>with-config-schema</h3><div class="usage"><code>(with-config-schema component schema)</code><code>(with-config-schema component config-key schema)</code></div><div class="doc"><div class="markdown"><p>Adds metadata to the component to define the configuration schema for the component.</p>
<p>The two arguments version is the original version. When using this approach, in concert with <a href="io.aviso.config.html#var-extend-system-map">extend-system-map</a>, the component should have a dependency on the configuration component (typically added to the system map as key :configuration). The configuration componment will be the configuration map, created via <a href="io.aviso.config.html#var-assemble-configuration">assemble-configuration</a>.</p>
<p>The modern alternative is the three argument variant. This defines a top-level configuration key (e.g., :web-service) and a schema for just that key.</p>
<p>The component will receive <em>just</em> that configuration in its :configuration key.</p>
<p>Alternately, the component may implement the <a href="io.aviso.config.html#var-Configurable">Configurable</a> protocol. It will be passed just its own configuration.</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/confiig/blob/master/src/io/aviso/config.clj#L361">view source</a></div></div></div></body></html>