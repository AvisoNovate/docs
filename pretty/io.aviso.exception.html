<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>io.aviso.exception documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Pretty</span> <span class="project-version">1.1</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>io</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>aviso</span></div></div></li><li class="depth-3 branch"><a href="io.aviso.ansi.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ansi</span></div></a></li><li class="depth-3 branch"><a href="io.aviso.binary.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>binary</span></div></a></li><li class="depth-3 branch"><a href="io.aviso.clipboard.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clipboard</span></div></a></li><li class="depth-3 branch"><a href="io.aviso.columns.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>columns</span></div></a></li><li class="depth-3 branch"><a href="io.aviso.component.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>component</span></div></a></li><li class="depth-3 branch current"><a href="io.aviso.exception.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>exception</span></div></a></li><li class="depth-3 branch"><a href="io.aviso.logging.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>logging</span></div></a></li><li class="depth-3"><a href="io.aviso.repl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>repl</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="io.aviso.exception.html#var-*app-frame-names*"><div class="inner"><span>*app-frame-names*</span></div></a></li><li class="depth-1"><a href="io.aviso.exception.html#var-*default-frame-filter*"><div class="inner"><span>*default-frame-filter*</span></div></a></li><li class="depth-1"><a href="io.aviso.exception.html#var-*default-frame-rules*"><div class="inner"><span>*default-frame-rules*</span></div></a></li><li class="depth-1"><a href="io.aviso.exception.html#var-*fonts*"><div class="inner"><span>*fonts*</span></div></a></li><li class="depth-1"><a href="io.aviso.exception.html#var-*traditional*"><div class="inner"><span>*traditional*</span></div></a></li><li class="depth-1"><a href="io.aviso.exception.html#var-analyze-exception"><div class="inner"><span>analyze-exception</span></div></a></li><li class="depth-1"><a href="io.aviso.exception.html#var-default-fonts"><div class="inner"><span>default-fonts</span></div></a></li><li class="depth-1"><a href="io.aviso.exception.html#var-demangle"><div class="inner"><span>demangle</span></div></a></li><li class="depth-1"><a href="io.aviso.exception.html#var-exception-dispatch"><div class="inner"><span>exception-dispatch</span></div></a></li><li class="depth-1"><a href="io.aviso.exception.html#var-expand-stack-trace"><div class="inner"><span>expand-stack-trace</span></div></a></li><li class="depth-1"><a href="io.aviso.exception.html#var-format-exception"><div class="inner"><span>format-exception</span></div></a></li><li class="depth-1"><a href="io.aviso.exception.html#var-parse-exception"><div class="inner"><span>parse-exception</span></div></a></li><li class="depth-1"><a href="io.aviso.exception.html#var-write-exception"><div class="inner"><span>write-exception</span></div></a></li><li class="depth-1"><a href="io.aviso.exception.html#var-write-exception*"><div class="inner"><span>write-exception*</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">io.aviso.exception</h1><div class="doc"><div class="markdown"><p>Format and present exceptions in a pretty (structured, formatted) way.</p></div></div><div class="public anchor" id="var-*app-frame-names*"><h3>*app-frame-names*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Set of filters (belong to your applications) to create more visual clarity.</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/pretty/blob/master/src/io/aviso/exception.clj#L26">view source</a></div></div><div class="public anchor" id="var-*default-frame-filter*"><h3>*default-frame-filter*</h3><h4 class="dynamic">dynamic</h4><h4 class="added">added in 0.1.16</h4><div class="usage"><code>(*default-frame-filter* frame)</code></div><div class="doc"><div class="markdown"><p>Default stack frame filter used when printing REPL exceptions. This will omit frames in the <code>clojure.lang</code> and <code>java.lang.reflect</code> package, hide frames in the <code>sun.reflect</code> package, and terminates the stack trace at the read-eval-print loop frame.</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/pretty/blob/master/src/io/aviso/exception.clj#L143">view source</a></div></div><div class="public anchor" id="var-*default-frame-rules*"><h3>*default-frame-rules*</h3><h4 class="dynamic">dynamic</h4><h4 class="added">added in 0.1.18</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>The set of rules that forms the basis for <a href="io.aviso.exception.html#var-*default-frame-filter*">*default-frame-filter*</a>, as a vector or vectors.</p>
<p>Each rule is three values:</p>
<ul>
  <li>
  <p>A function that extracts the value from the stack frame map (typically, this is a keyword such as :package or :name). The value is converted to a string.</p></li>
  <li>
  <p>A string or regexp used for matching.</p></li>
  <li>
  <p>A resulting frame visibility (:hide, :omit, :terminate, or :show).</p></li>
</ul>
<p>The default rules:</p>
<ul>
  <li>omit everything in clojure.lang and java.lang.reflect.</li>
  <li>hide everything in sun.reflect</li>
  <li>terminate at speclj.* or clojure.main/repl/read-eval-print</li>
</ul></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/pretty/blob/master/src/io/aviso/exception.clj#L103">view source</a></div></div><div class="public anchor" id="var-*fonts*"><h3>*fonts*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Current set of fonts used in exception formatting</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/pretty/blob/master/src/io/aviso/exception.clj#L30">view source</a></div></div><div class="public anchor" id="var-*traditional*"><h3>*traditional*</h3><h4 class="dynamic">dynamic</h4><h4 class="added">added in 0.1.15</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>If bound to true, then exceptions will be formatted the traditional way - the same as Java exceptions with the deepest stack frame first. By default, the stack trace is inverted, so that the deepest stack frames come last, mimicking chronological order.</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/pretty/blob/master/src/io/aviso/exception.clj#L35">view source</a></div></div><div class="public anchor" id="var-analyze-exception"><h3>analyze-exception</h3><div class="usage"><code>(analyze-exception e options)</code></div><div class="doc"><div class="markdown"><p>Converts an exception into a seq of maps representing nested exceptions. The order reflects exception nesting; first exception is the most recently thrown, last is the deepest, or root, exception … the initial exception thrown in a chain of nested exceptions.</p>
<p>The options map is as defined by <a href="io.aviso.exception.html#var-write-exception">write-exception</a>.</p>
<p>Each exception map contains:</p>
<dl>
  <dt>:class-name String
  </dt>
  <dd>name of the Java class for the exception</dd>
  <dt>:message String
  </dt>
  <dd>value of the exception’s message property (possibly nil)</dd>
  <dt>:properties Map
  </dt>
  <dd>map of properties to (optionally) present in the exception report</dd>
  <dt>:stack-trace Vector
  </dt>
  <dd>stack trace element maps, or nil.  Only present in the root exception.</dd>
</dl>
<p>The :properties map does not include any properties that are assignable to type Throwable.</p>
<p>The first property that is assignable to type Throwable (not necessarily the rootCause property) will be used as the nested exception (for the next map in the sequence).</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/pretty/blob/master/src/io/aviso/exception.clj#L422">view source</a></div></div><div class="public anchor" id="var-default-fonts"><h3>default-fonts</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>A default set of fonts for different elements in the formatted exception report.</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/pretty/blob/master/src/io/aviso/exception.clj#L13">view source</a></div></div><div class="public anchor" id="var-demangle"><h3>demangle</h3><div class="usage"><code>(demangle s)</code></div><div class="doc"><div class="markdown"><p>De-mangle a Java name back to a Clojure name by converting mangled sequences, such as “<em>QMARK</em>” back into simple characters.</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/pretty/blob/master/src/io/aviso/exception.clj#L80">view source</a></div></div><div class="public anchor" id="var-exception-dispatch"><h3>exception-dispatch</h3><h4 class="type">multimethod</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>The pretty print dispatch function used when formatting exception output (specifically, when printing the properties of an exception). Normally, this is the same as the simple-dispatch (in clojure.pprint) but can be extended for specific cases:</p>
<pre><code>(import com.stuartsierra.component.SystemMap)

(defmethod exception-dispatch SystemMap [system-map] (print "#&lt;SystemMap&gt;"))
</code></pre>
<p>This ensures that the SystemMap record, wherever it appears in the exception output, is represented as the string <code>#&lt;SystemMap&gt;</code>; normally it would print as a deeply nested set of maps.</p>
<p>See the <a href="io.aviso.component.html">io.aviso.component</a> namespace for more complete example.</p>
<p>This same approach can be adapted to any class or type whose structure is problematic for presenting in the exception output, whether for size and complexity reasons, or due to security concerns.</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/pretty/blob/master/src/io/aviso/exception.clj#L479">view source</a></div></div><div class="public anchor" id="var-expand-stack-trace"><h3>expand-stack-trace</h3><div class="usage"><code>(expand-stack-trace exception)</code></div><div class="doc"><div class="markdown"><p>Extracts the stack trace for an exception and returns a seq of expanded stack frame maps:</p>
<dl>
  <dt>:file String
  </dt>
  <dd>file name</dd>
  <dt>:line Integer
  </dt>
  <dd>line number as an integer, or nil</dd>
  <dt>:class String
  </dt>
  <dd>fully qualified Java class name</dd>
  <dt>:package String
  </dt>
  <dd>Java package name, or nil for root package</dd>
  <dt>:simple-class String
  </dt>
  <dd>simple name of Java class (without package prefix)</dd>
  <dt>:method String
  </dt>
  <dd>Java method name</dd>
  <dt>:is-clojure?
  </dt>
  <dd>true if this represents a Clojure function call, rather than a Java  method invocation.</dd>
  <dt>:name String
  </dt>
  <dd>Fully qualified Clojure name (demangled from the Java class name), or the empty string for non-Clojure stack frames</dd>
  <dt>:names seq of String
  </dt>
  <dd>Clojure name split at slashes (empty for non-Clojure stack frames)</dd>
</dl></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/pretty/blob/master/src/io/aviso/exception.clj#L295">view source</a></div></div><div class="public anchor" id="var-format-exception"><h3>format-exception</h3><div class="usage"><code>(format-exception exception)</code><code>(format-exception exception options)</code></div><div class="doc"><div class="markdown"><p>Formats an exception as a multi-line string using <a href="io.aviso.exception.html#var-write-exception">write-exception</a>.</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/pretty/blob/master/src/io/aviso/exception.clj#L637">view source</a></div></div><div class="public anchor" id="var-parse-exception"><h3>parse-exception</h3><h4 class="added">added in 0.1.21</h4><div class="usage"><code>(parse-exception exception-text options)</code></div><div class="doc"><div class="markdown"><p>Given a chunk of text for an exception report (as with <code>.printStackTrace</code>), attempts to piece together the same information provided by <a href="io.aviso.exception.html#var-analyze-exception">analyze-exception</a>. The result is ready to pass to <a href="io.aviso.exception.html#var-write-exception*">write-exception*</a>.</p>
<p>This code does not attempt to recreate properties associated with the exceptions; in most exception’s cases, this is not necessarily written to the output. For clojure.lang.ExceptionInfo, it is hard to distinguish the message text from the printed exception map.</p>
<p>The options are used when processing the stack trace and may include the :filter and :frame-limit keys.</p>
<p>Returns a sequence of exception maps; the final map will include the :stack-trace key (a vector of stack trace element maps). The exception maps are ordered outermost to innermost (that final map is the root exception).</p>
<p>This should be considered experimental code; there are many cases where it may not work properly.</p>
<p>It will work quite poorly with exceptions whose message incorporates a nested exception’s .printStackTrace output. This happens too often with JDBC exceptions, for example.</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/pretty/blob/master/src/io/aviso/exception.clj#L689">view source</a></div></div><div class="public anchor" id="var-write-exception"><h3>write-exception</h3><div class="usage"><code>(write-exception exception)</code><code>(write-exception exception options)</code></div><div class="doc"><div class="markdown"><p>Writes a formatted version of the exception to <em>out</em>. By default, includes the stack trace, with no frame limit.</p>
<p>The options map may have the following keys:</p>
<dl>
  <dt>:filter
  </dt>
  <dd>The stack frame filter, which defaults to <a href="null">*default-stack-frame-filter*</a>.</dd>
  <dt>:properties
  </dt>
  <dd>If true (the default) then properties of exceptions will be output.</dd>
  <dt>:frame-limit
  </dt>
  <dd>If non-nil, the number of stack frames to keep when outputing the stack trace  of the deepest exception.</dd>
</dl>
<p>Output may be traditional or modern, as controlled by <a href="io.aviso.exception.html#var-*traditional*">*traditional*</a>. Traditional is the typical output order for Java: the stack of exceptions comes first (outermost to innermost) followed by the stack trace of the innermost exception, with the frames in deepest to shallowest order.</p>
<p>Modern output is more readable; the stack trace comes first and is reversed: shallowest frame to deepest. Then the exception stack is output, from the root exception to the outermost exception. The modern output order is more readable, as it puts the most useful information together at the bottom, so that it is not necessary to scroll back to see, for example, where the exception occurred.</p>
<p>The default is modern.</p>
<p>The stack frame filter is passed the map detailing each stack frame in the stack trace, must return one of the following values:</p>
<dl>
  <dt>:show
  </dt>
  <dd>is the normal state; display the stack frame.</dd>
  <dt>:hide
  </dt>
  <dd>prevents the frame from being displayed, as if it never existed.</dd>
  <dt>:omit
  </dt>
  <dd>replaces the frame with a “…” placeholder; multiple consecutive :omits will be collapsed to a single line.  Use :omit for “uninteresting” stack frames.</dd>
  <dt>:terminate
  </dt>
  <dd>hides the frame AND all later frames.</dd>
</dl>
<p>The default filter is <a href="io.aviso.exception.html#var-*default-frame-filter*">*default-frame-filter*</a>. An explicit filter of nil will display all stack frames.</p>
<p>Repeating lines are collapsed to a single line, with a repeat count. Typically, this is the result of an endless loop that terminates with a StackOverflowException.</p>
<p>When set, the frame limit is the number of stack frames to display; if non-nil, then some of the outermost stack frames may be omitted. It may be set to 0 to omit the stack trace entirely (but still display the exception stack). The frame limit is applied after the frame filter (which may hide or omit frames) and after repeating stack frames have been identified and coalesced … :frame-limit is really the number of <em>output</em> lines to present.</p>
<p>Properties of exceptions will be output using Clojure’s pretty-printer, honoring all of the normal vars used to configure pretty-printing; however, if <code>*print-length*</code> is left as its default (nil), the print length will be set to 10. This is to ensure that infinite lists do not cause endless output or other exceptions.</p>
<p>The <code>*fonts*</code> var contains ANSI definitions for how fonts are displayed; bind it to nil to remove ANSI formatting entirely. It can be also initialized to nil instead of the default set of fonts by setting environment variable DISABLE_DEFAULT_PRETTY_FONTS to any value.</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/pretty/blob/master/src/io/aviso/exception.clj#L570">view source</a></div></div><div class="public anchor" id="var-write-exception*"><h3>write-exception*</h3><h4 class="added">added in 0.1.21</h4><div class="usage"><code>(write-exception* exception-stack options)</code></div><div class="doc"><div class="markdown"><p>Contains the main logic for <a href="io.aviso.exception.html#var-write-exception">write-exception</a>, which simply expands the exception (via <a href="io.aviso.exception.html#var-analyze-exception">analyze-exception</a>) before invoking this function.</p>
<p>This code was extracted so as to support <a href="io.aviso.exception.html#var-parse-exception">parse-exception</a>.</p></div></div><div class="src-link"><a href="https://github.com/AvisoNovate/pretty/blob/master/src/io/aviso/exception.clj#L525">view source</a></div></div></div></body></html>